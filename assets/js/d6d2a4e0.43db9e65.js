"use strict";(self.webpackChunkclassic=self.webpackChunkclassic||[]).push([[5425],{3905:function(e,n,a){a.d(n,{Zo:function(){return m},kt:function(){return d}});var t=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function s(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=t.createContext({}),c=function(e){var n=t.useContext(i),a=n;return e&&(a="function"==typeof e?e(n):s(s({},n),e)),a},m=function(e){var n=c(e.components);return t.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=c(a),d=r,k=p["".concat(i,".").concat(d)]||p[d]||u[d]||o;return a?t.createElement(k,s(s({ref:n},m),{},{components:a})):t.createElement(k,s({ref:n},m))}));function d(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=p;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var c=2;c<o;c++)s[c]=a[c];return t.createElement.apply(null,s)}return t.createElement.apply(null,a)}p.displayName="MDXCreateElement"},8215:function(e,n,a){var t=a(7294);n.Z=function(e){var n=e.children,a=e.hidden,r=e.className;return t.createElement("div",{role:"tabpanel",hidden:a,className:r},n)}},6396:function(e,n,a){a.d(n,{Z:function(){return p}});var t=a(7462),r=a(7294),o=a(2389),s=a(9443);var l=function(){var e=(0,r.useContext)(s.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},i=a(3616),c=a(6010),m="tabItem_vU9c";function u(e){var n,a,o,s=e.lazy,u=e.block,p=e.defaultValue,d=e.values,k=e.groupId,b=e.className,g=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),h=null!=d?d:g.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),f=(0,i.lx)(h,(function(e,n){return e.value===n.value}));if(f.length>0)throw new Error('Docusaurus error: Duplicate values "'+f.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var v=null===p?p:null!=(n=null!=p?p:null==(a=g.find((function(e){return e.props.default})))?void 0:a.props.value)?n:null==(o=g[0])?void 0:o.props.value;if(null!==v&&!h.some((function(e){return e.value===v})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+h.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var w=l(),y=w.tabGroupChoices,N=w.setTabGroupChoices,_=(0,r.useState)(v),C=_[0],T=_[1],j=[],A=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=k){var x=y[k];null!=x&&x!==C&&h.some((function(e){return e.value===x}))&&T(x)}var E=function(e){var n=e.currentTarget,a=j.indexOf(n),t=h[a].value;t!==C&&(A(n),T(t),null!=k&&N(k,t))},O=function(e){var n,a=null;switch(e.key){case"ArrowRight":var t=j.indexOf(e.currentTarget)+1;a=j[t]||j[0];break;case"ArrowLeft":var r=j.indexOf(e.currentTarget)-1;a=j[r]||j[j.length-1]}null==(n=a)||n.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,c.Z)("tabs",{"tabs--block":u},b)},h.map((function(e){var n=e.value,a=e.label,o=e.attributes;return r.createElement("li",(0,t.Z)({role:"tab",tabIndex:C===n?0:-1,"aria-selected":C===n,key:n,ref:function(e){return j.push(e)},onKeyDown:O,onFocus:E,onClick:E},o,{className:(0,c.Z)("tabs__item",m,null==o?void 0:o.className,{"tabs__item--active":C===n})}),null!=a?a:n)}))),s?(0,r.cloneElement)(g.filter((function(e){return e.props.value===C}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},g.map((function(e,n){return(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==C})}))))}function p(e){var n=(0,o.Z)();return r.createElement(u,(0,t.Z)({key:String(n)},e))}},8361:function(e,n,a){a.r(n),a.d(n,{frontMatter:function(){return c},contentTitle:function(){return m},metadata:function(){return u},assets:function(){return p},toc:function(){return d},default:function(){return b}});var t=a(7462),r=a(3366),o=(a(7294),a(3905)),s=a(6396),l=a(8215),i=["components"],c={title:"Kubed - secret sync between k8s clusters in different aws accounts",description:"Kubed - secret sync between k8s clusters in different aws accounts",slug:"kubed-cross-sync",authors:["a.horbach"],tags:["aws","k8s"],image:"https://i.imgur.com/mErPwqL.png",hide_table_of_contents:!1},m="title",u={permalink:"/Andrew-Horbach.github.io-Public/blog/kubed-cross-sync",editUrl:"https://github.com/karma-git/Andrew-Horbach.github.io-Public/blob/master/blog/2022-11-22-kubed-cross-sync.md",source:"@site/blog/2022-11-22-kubed-cross-sync.md",title:"Kubed - secret sync between k8s clusters in different aws accounts",description:"Kubed - secret sync between k8s clusters in different aws accounts",date:"2022-11-22T00:00:00.000Z",formattedDate:"November 22, 2022",tags:[{label:"aws",permalink:"/Andrew-Horbach.github.io-Public/blog/tags/aws"},{label:"k8s",permalink:"/Andrew-Horbach.github.io-Public/blog/tags/k-8-s"}],readingTime:6.855,truncated:!1,authors:[{name:"Andrew Horbach",url:"https://github.com/karma-git",imageURL:"https://github.com/karma-git.png",key:"a.horbach"}],prevItem:{title:"Terraformer - reverse Terraform",permalink:"/Andrew-Horbach.github.io-Public/blog/terraformer"},nextItem:{title:"Lens - build from source",permalink:"/Andrew-Horbach.github.io-Public/blog/lens-build"}},p={authorsImageUrls:[void 0]},d=[{value:"\u0418\u0441\u0442\u043e\u0440\u0438\u044f, \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430",id:"\u0438\u0441\u0442\u043e\u0440\u0438\u044f-\u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430",children:[{value:"1) aws account mc-legacy",id:"1-aws-account-mc-legacy",children:[],level:3},{value:"2) aws account mc-project",id:"2-aws-account-mc-project",children:[],level:3},{value:"3) combine",id:"3-combine",children:[],level:3},{value:"4) Concept",id:"4-concept",children:[],level:3}],level:2},{value:"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438",id:"\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438",children:[{value:"AWS IAM RBAC",id:"aws-iam-rbac",children:[{value:"<code>mc-mgmt aka kubed-master</code>",id:"mc-mgmt-aka-kubed-master",children:[],level:4},{value:"<code>mc-project</code> aka kubed-follower",id:"mc-project-aka-kubed-follower",children:[],level:4},{value:"ServiceAccount kubed",id:"serviceaccount-kubed",children:[],level:4},{value:"ConfgiMap aws-auth",id:"confgimap-aws-auth",children:[],level:4}],level:3},{value:"Docker image",id:"docker-image",children:[],level:3},{value:"K8s controller",id:"k8s-controller",children:[],level:3}],level:2},{value:"\u0421\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0439",id:"\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f-\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0439",children:[],level:2},{value:"\u041d\u044e\u0430\u043d\u0441\u044b \u0440\u0430\u0431\u043e\u0442\u044b",id:"\u043d\u044e\u0430\u043d\u0441\u044b-\u0440\u0430\u0431\u043e\u0442\u044b",children:[],level:2},{value:"\u0421\u0441\u044b\u043b\u043a\u0438",id:"\u0441\u0441\u044b\u043b\u043a\u0438",children:[],level:2}],k={toc:d};function b(e){var n=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,t.Z)({},k,a,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"\u0438\u0441\u0442\u043e\u0440\u0438\u044f-\u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430"},"\u0418\u0441\u0442\u043e\u0440\u0438\u044f, \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430"),(0,o.kt)("h3",{id:"1-aws-account-mc-legacy"},"1) aws account mc-legacy"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://ah-public-pictures.hb.bizmrg.com/it-happens/kubed-cross-sync-1.jpeg",alt:"img"})),(0,o.kt)("p",null,"\u0418\u043c\u0435\u0435\u0442\u0441\u044f legacy \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0432 aws \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0435:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u0412 route53 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d \u0434\u043e\u043c\u0435\u043d ",(0,o.kt)("inlineCode",{parentName:"li"},"<my-company>.io")," \u0438 \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u0430\u044f hosted zone"),(0,o.kt)("li",{parentName:"ol"},"\u0412 \u0437\u043e\u043d\u0435 \u0435\u0441\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c ",(0,o.kt)("inlineCode",{parentName:"li"},"<my-service>.<my-company>.io")," , \u0441\u043c\u043e\u0442\u0440\u0438\u0442 \u043d\u0430 ",(0,o.kt)("inlineCode",{parentName:"li"},"<lb>.<my-company>.io")),(0,o.kt)("li",{parentName:"ol"},"\u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u0432\u0435\u0434\u0435\u0442 \u043d\u0430 ASG"),(0,o.kt)("li",{parentName:"ol"},"ASG \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 EC2 \u0438\u043d\u0441\u0430\u043d\u0441\u0430\u043c\u0438 \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 ",(0,o.kt)("inlineCode",{parentName:"li"},"<my-service>"))),(0,o.kt)("h3",{id:"2-aws-account-mc-project"},"2) aws account mc-project"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://ah-public-pictures.hb.bizmrg.com/it-happens/kubed-cross-sync-2.jpeg",alt:"img"})),(0,o.kt)("p",null,"\u041f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442\u0441\u044f \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u0432\u0435\u0437\u0442\u0438 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0432 kubernetes, \u0434\u043b\u044f \u0443\u0434\u043e\u0431\u0441\u0442\u0432\u0430 \u043f\u043e\u0434 \u043a\u0430\u0436\u0434\u0443\u044e \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0441\u0432\u043e\u0439 aws \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0438 \u0441\u0432\u043e\u0439 k8s \u043a\u043b\u0430\u0441\u0442\u0435\u0440:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u0412 aws \u043f\u043e\u0434\u043d\u0438\u043c\u0430\u0435\u0442\u0441\u044f NLB \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a ",(0,o.kt)("inlineCode",{parentName:"li"},"<lb-my-project>")),(0,o.kt)("li",{parentName:"ol"},"\u0427\u0435\u0440\u0435\u0437 target groups \u043e\u043d \u0441\u043c\u043e\u0442\u0440\u0438\u0442 \u043d\u0430 EC2 \u0438\u043d\u0441\u0442\u0430\u043d\u0441\u044b, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0437\u0430\u043f\u0443\u0449\u0435\u043d pod \u0441 ingress controller-\u043e\u043c."),(0,o.kt)("li",{parentName:"ol"},"\u041f\u043e\u043f\u0430\u0434\u0430\u044f \u0432 pod \u0438\u043d\u0433\u0440\u0435\u0441\u0441\u0430, \u0437\u0430\u043f\u0440\u043e\u0441 \u0447\u0435\u0440\u0435\u0437 Ingress \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0430 pod-\u044b \u0437\u0430 ",(0,o.kt)("inlineCode",{parentName:"li"},"<my-service>")," \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e k8s service.")),(0,o.kt)("h3",{id:"3-combine"},"3) combine"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://ah-public-pictures.hb.bizmrg.com/it-happens/kubed-cross-sync-3.jpeg",alt:"img"})),(0,o.kt)("p",null,"r53 \u0437\u0430\u043f\u0438\u0441\u044c ",(0,o.kt)("inlineCode",{parentName:"p"},"<my-service>.<my-company>.io")," \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442 \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043d\u0430 CNAME ",(0,o.kt)("inlineCode",{parentName:"p"},"<lb-my-project>"),", \u0432\u0441\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442, \u043d\u043e SSL \u043d\u0435 \u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u0443\u0435\u0442\u0441\u044f."),(0,o.kt)("p",null,"\u0417\u043e\u043d\u0430 ",(0,o.kt)("inlineCode",{parentName:"p"},"<my-company>.io")," \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u0430 \u0434\u043b\u044f \u0431\u0438\u0437\u043d\u0435\u0441\u0430, \u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c \u0432 \u043d\u0435\u0435 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430\u043c \u0442\u0438\u043f\u0430 external-dns, cert-manager \u043d\u0435 \u0445\u043e\u0447\u0435\u0442\u0441\u044f."),(0,o.kt)("p",null,"\u0412 \u0442\u043e\u0436\u0435 \u0432\u0440\u0435\u043c\u044f aws \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u043e\u0432 \u0442\u0438\u043f\u0430 ",(0,o.kt)("inlineCode",{parentName:"p"},"mc-project")," \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043c\u043d\u043e\u0433\u043e, \u043a\u0430\u043a \u0438 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u043e\u0432 k8s, \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c \u0441\u0435\u043a\u0440\u0435\u0442 \u0441 tls \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u043c \u043d\u0435 \u0445\u043e\u0447\u0435\u0442\u0441\u044f."),(0,o.kt)("h3",{id:"4-concept"},"4) Concept"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://ah-public-pictures.hb.bizmrg.com/it-happens/kubed-cross-sync-4.png",alt:"img"})),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u0421\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 management aws \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0438 k8s \u043a\u043b\u0430\u0441\u0442\u0435\u0440."),(0,o.kt)("li",{parentName:"ol"},"\u0412 \u043d\u0435\u0433\u043e \u043a\u0430\u043a\u0438\u043c-\u0442\u043e \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u0435\u043a\u0440\u0435\u0442 \u0441 tls \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u043c ",(0,o.kt)("inlineCode",{parentName:"li"},"*.<my-company>.io")),(0,o.kt)("li",{parentName:"ol"},"\u0421\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/kubeops/config-syncer"},"kubed")," \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0441\u0435\u043a\u0440\u0435\u0442 ",(0,o.kt)("inlineCode",{parentName:"li"},"*.<my-company>.io")," \u0432 \u0434\u0440\u0443\u0433\u0438\u0435 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u044b k8s \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043d\u043d\u043e\u0442\u0430\u0446\u0438\u0439."),(0,o.kt)("li",{parentName:"ol"},"\u0421\u0435\u043a\u0440\u0435\u0442 ",(0,o.kt)("inlineCode",{parentName:"li"},"*.<my-company>.io")," \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 Ingress, SSL \u0442\u0440\u0430\u0444\u0444\u0438\u043a \u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u0443\u0435\u0442\u0441\u044f.")),(0,o.kt)("h2",{id:"\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438"},"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"\u0412 \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u0430\u0445 \u0440\u043e\u043b\u0438 \u0434\u043b\u044f ",(0,o.kt)("inlineCode",{parentName:"p"},"mc-mgmt")," \u0431\u0443\u0434\u0443\u0442 \u043d\u0430\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f ",(0,o.kt)("inlineCode",{parentName:"p"},"kubed-master"),", \u0430 ",(0,o.kt)("inlineCode",{parentName:"p"},"mc-project-*")," - ",(0,o.kt)("inlineCode",{parentName:"p"},"kubed-follower")))),(0,o.kt)("h3",{id:"aws-iam-rbac"},"AWS IAM RBAC"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"\u041d\u0430 \u0441\u0445\u0435\u043c\u0435 ",(0,o.kt)("inlineCode",{parentName:"p"},"mc-mgmt")," = ",(0,o.kt)("inlineCode",{parentName:"p"},"CI"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"mc-project")," - ",(0,o.kt)("inlineCode",{parentName:"p"},"Target")))),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://ah-public-pictures.hb.bizmrg.com/it-happens/kubed-cross-sync-aws-rbac.png",alt:"img"})),(0,o.kt)("p",null,"\u041d\u0443\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u043a\u0440\u043e\u0441\u0441-\u0430\u043a\u043a\u0430\u0443\u043d\u0442 aws iam rbac \u0440\u043e\u043b\u0438, \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b ",(0,o.kt)("strong",{parentName:"p"},"kubed")," \u0438\u0437 ",(0,o.kt)("inlineCode",{parentName:"p"},"mc-mgmt")," \u043c\u043e\u0433 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0441\u0435\u043a\u0440\u0435\u0442\u0430\u043c\u0438 \u0432 k8s \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430\u0445 \u0434\u0440\u0443\u0433\u0438\u0445 aws \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u043e\u0432, \u0432 \u0434\u0430\u043d\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 ",(0,o.kt)("inlineCode",{parentName:"p"},"mc-project"),"."),(0,o.kt)("h4",{id:"mc-mgmt-aka-kubed-master"},(0,o.kt)("inlineCode",{parentName:"h4"},"mc-mgmt aka kubed-master")),(0,o.kt)(s.Z,{defaultValue:"hcl",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"hcl",label:"Terraform",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'locals {\n  kubed_followers_arns = [\n    for _, id in local.aws_accounts_map : "arn:aws:iam::${id}:role/kubed-follower"\n  ]\n}\n\nmodule "iam_assumable_role_kubed_master" {\n  source  = "terraform-aws-modules/iam/aws//modules/iam-assumable-role-with-oidc"\n  version = "4.2.0"\n\n  create_role = true\n  role_name   = "kubed-master"\n\n  provider_url = replace(local.cluster_oidc_issuer_url, "https://", "")\n\n  role_policy_arns = [\n    aws_iam_policy.kubed_master.arn,\n    aws_iam_policy.kubed_eks.arn,\n  ]\n\n  oidc_fully_qualified_subjects = [\n    "system:serviceaccount:kube-system:kubed"\n  ]\n}\n\ndata "aws_iam_policy_document" "kubed_master" {\n  statement {\n    sid    = "kubedMaster"\n    effect = "Allow"\n    actions = [\n      "sts:AssumeRole",\n    ]\n    resources = local.kubed_followers_arns\n  }\n}\n\nresource "aws_iam_policy" "kubed_master" {\n  name   = "kubed-master"\n  policy = data.aws_iam_policy_document.kubed_master.json\n}\n\ndata "aws_iam_policy_document" "kubed_eks" {\n  statement {\n    sid    = "kubedEks"\n    effect = "Allow"\n    actions = [\n      "eks:DescribeCluster",\n      "eks:ListClusters"\n    ]\n    resources = ["*"]\n  }\n}\n\nresource "aws_iam_policy" "kubed_eks" {\n  name   = "kubed-eks"\n  policy = data.aws_iam_policy_document.kubed_eks.json\n}\n'))),(0,o.kt)(l.Z,{value:"trust",label:"Trust policy",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "",\n            "Effect": "Allow",\n            "Principal": {\n                "Federated": "arn:aws:iam:::<mc-mgmt_id>:oidc-provider/oidc.eks.<aws_region>.amazonaws.com/id/<mc-mgmt_oidc>"\n            },\n            "Action": "sts:AssumeRoleWithWebIdentity",\n            "Condition": {\n                "StringEquals": {\n                    "oidc.eks.<aws_region>.amazonaws.com/id/<mc-mgmt_oidc>:sub": "system:serviceaccount:kube-system:kubed"\n                }\n            }\n        }\n    ]\n}\n'))),(0,o.kt)(l.Z,{value:"policy-kubed-master",label:"Policy kubed-master",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "kubedMaster",\n            "Effect": "Allow",\n            "Action": "sts:AssumeRole",\n            "Resource": [\n                "arn:aws:iam::<mc-project_id>:role/kubed-follower"\n            ]\n        }\n    ]\n}\n'))),(0,o.kt)(l.Z,{value:"policy-kubed-eks",label:"Policy kubed-eks",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "kubedEks",\n            "Effect": "Allow",\n            "Action": [\n                "eks:ListClusters",\n                "eks:DescribeCluster"\n            ],\n            "Resource": "*"\n        }\n    ]\n}\n')))),(0,o.kt)("h4",{id:"mc-project-aka-kubed-follower"},(0,o.kt)("inlineCode",{parentName:"h4"},"mc-project")," aka kubed-follower"),(0,o.kt)(s.Z,{defaultValue:"hcl",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"hcl",label:"Terraform",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'locals {\n  mc_mgmt_id = "<mc-mgmt_id>"\n}\n\ndata "aws_iam_policy_document" "kubed_follower_assume" {\n  statement {\n    sid    = "kubedFollowerAssume"\n    effect = "Allow"\n    principals {\n      identifiers = toset(["arn:aws:iam::${local.mc_mgmt_id}:role/kubed-master"])\n      type        = "AWS"\n    }\n    actions = [\n      "sts:AssumeRole",\n    ]\n  }\n}\n\ndata "aws_iam_policy_document" "kubed_follower" {\n  statement {\n    sid    = "kubedEks"\n    effect = "Allow"\n    actions = [\n      "eks:DescribeCluster",\n      "eks:ListClusters"\n    ]\n    resources = ["*"]\n  }\n}\n\n\nresource "aws_iam_policy" "kubed_follower" {\n  name   = "kubed-follower"\n  policy = data.aws_iam_policy_document.kubed_follower.json\n}\n\n\nresource "aws_iam_role" "kubed_follower" {\n  name                = "kubed-follower"\n  description         = "IAM role which allows kubed sync secrets from mc-mgmt to this account"\n  assume_role_policy  = data.aws_iam_policy_document.kubed_follower_assume.json\n  managed_policy_arns = [aws_iam_policy.kubed_follower.arn]\n}\n'))),(0,o.kt)(l.Z,{value:"trust",label:"Trust policy",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "kubedFollowerAssume",\n            "Effect": "Allow",\n            "Principal": {\n                "AWS": "arn:aws:iam:::<mc-mgmt_id>:role/kubed-master"\n            },\n            "Action": "sts:AssumeRole"\n        }\n    ]\n}\n'))),(0,o.kt)(l.Z,{value:"iam-policy",label:"Policy kubed-eks",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Statement": [\n        {\n            "Action": [\n                "eks:ListClusters",\n                "eks:DescribeCluster"\n            ],\n            "Effect": "Allow",\n            "Resource": "*",\n            "Sid": "kubedEks"\n        }\n    ],\n    "Version": "2012-10-17"\n}\n')))),(0,o.kt)("h4",{id:"serviceaccount-kubed"},"ServiceAccount kubed"),(0,o.kt)("p",null,"\u041d\u0430 ",(0,o.kt)("strong",{parentName:"p"},"ServiceAccount")," kubed-master \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u0432\u0435\u0441\u0438\u0442\u044c \u0430\u043d\u043d\u043e\u0442\u0430\u0446\u0438\u044e:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"annotations:\n  eks.amazonaws.com/role-arn: arn:aws:iam::<mc-mgmt_id>:role/kubed-master\n")),(0,o.kt)("h4",{id:"confgimap-aws-auth"},"ConfgiMap aws-auth"),(0,o.kt)(s.Z,{defaultValue:"kubed-master",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"kubed-master",label:"kubed master",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: aws-auth\n  namespace: kube-system\ndata:\n  mapRoles: |\n    - "groups":\n      - "system:masters"\n      "rolearn": "arn:aws:iam::<mc-mgmt_id>:role/kubed-master"\n      "username": ""\n      ...\n'))),(0,o.kt)(l.Z,{value:"kubed-follower",label:"kubed follower",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: aws-auth\n  namespace: kube-system\ndata:\n  mapRoles: |\n    - "groups":\n      - "system:masters"\n      "rolearn": "arn:aws:iam::<mc-project_id>:role/kubed-follower"\n      "username": ""\n      ...\n')))),(0,o.kt)("h3",{id:"docker-image"},"Docker image"),(0,o.kt)("p",null,"\u041e\u0431\u0440\u0430\u0437 \u043e\u0442 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u043e\u0432 scratch, \u0432 \u043d\u0435\u043c \u0435\u0441\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0431\u0438\u043d\u0430\u0440\u043d\u0438\u043a kubed, \u043d\u0430\u043c \u0436\u0435 \u043d\u0443\u0436\u043d\u044b \u0443\u0442\u0438\u043b\u0438\u0442\u044b aws \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f kubeconfig."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Dockerfile"},'FROM appscode/kubed:v0.13.2 as downloader\n\nFROM alpine:3.17\n\nCOPY --from=downloader /kubed /usr/bin/kubed\n\nRUN apk add --no-cache \\\n  curl~=7.86 \\\n  py3-pip~=22.3 \\\n  && pip install --no-cache-dir \\\n  awscli~=1.27 \\\n  && curl -Lo aws-iam-authenticator https://github.com/kubernetes-sigs/aws-iam-authenticator/releases/download/v0.5.9/aws-iam-authenticator_0.5.9_linux_amd64 \\\n  && chmod +x aws-iam-authenticator \\\n  && mv aws-iam-authenticator /usr/bin/\n\nRUN addgroup --gid 1950 app \\\n  && addgroup --gid 1000 app \\\n  && adduser \\\n  --uid 1000 \\\n  --home /home/app \\\n  --shell /bin/ash \\\n  --ingroup app \\\n  --disabled-password \\\n  app \\\n  && addgroup app app\n\nUSER 1000\nWORKDIR /home/app\n\nENTRYPOINT ["/usr/bin/kubed"]\n')),(0,o.kt)("h3",{id:"k8s-controller"},"K8s controller"),(0,o.kt)("p",null,"\u0412 mc-mgmt \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435 \u0442\u0430\u043a \u0436\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043e\u0431\u044b\u0447\u043d\u044b\u0439 \u0438\u043d\u0442\u0430\u043d\u0441 kubed-\u0430, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0439 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kubeops/config-syncer/tree/master/charts/kubed"},"helm \u0447\u0430\u0440\u0442\u043e\u043c"),", \u0438\u0437 \u043d\u0435\u0433\u043e \u043c\u044b \u0438 \u0431\u0435\u0440\u0435\u043c \u0432\u0441\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 k8s RBAC-\u0438."),(0,o.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"\u042d\u0442\u043e\u0442 \u0441\u043f\u043e\u0441\u043e\u0431 ",(0,o.kt)("strong",{parentName:"p"},"\u0434\u0435\u0441\u0442\u0440\u0443\u043a\u0442\u0438\u0432\u0435\u043d"),", \u043d\u0435\u0432\u0435\u0440\u043d\u0430\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f kubed-master \u043c\u043e\u0436\u0435\u0442 \u0440\u0435\u0432\u0435\u0440\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044e \u0441\u0435\u043a\u0440\u0435\u0442\u043e\u0432 \u043c\u0435\u0436\u0434\u0443 namespace-\u0430\u043c\u0438. \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u044f \u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043b\u0430\u0441\u0442\u0435\u0440 \u0434\u043b\u044f kubed-master"))),(0,o.kt)(s.Z,{defaultValue:"cm",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"cm",label:"ConfigMap",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kubed-master-aws\n  namespace: kube-system\ndata:\n  credentials: |-\n    [mc-mgmt]\n    role_arn = arn:aws:iam::<mc-mgmt_id>:role/kubed-master\n    web_identity_token_file = /var/run/secrets/eks.amazonaws.com/serviceaccount/token\n    [mc-project]\n    role_arn = arn:aws:iam::<mc-project_id>:role/kubed-follower\n    source_profile = mc-mgmt\n    role_session_name = mc-project\n  generate-kubeconfig.sh: |-\n    #!/bin/bash\n    set -eux\n\n    aws eks update-kubeconfig --name mc-project-k8s --alias mc-project-k8s --profile mc-project\n\n    # NOTE: mc-mgmt-k8s should the last due to current-context\n    aws eks update-kubeconfig --name mc-mgmt-k8s --alias mc-mgmt-k8s --profile mc-mgmt\n"))),(0,o.kt)(l.Z,{value:"deploy",label:"Deployment",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: kubed-master\n  namespace: kube-system\n  labels:\n    app.kubernetes.io/name: kubed-master\n    app.kubernetes.io/instance: kubed-master\n    app.kubernetes.io/version: "v0.13.2"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: kubed-master\n      app.kubernetes.io/instance: kubed-master\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/name: kubed-master\n        app.kubernetes.io/instance: kubed-master\n    spec:\n      serviceAccountName: kubed\n      # NOTE: kubeconfig-generator\n      initContainers:\n        - name: kubeconfig-generator\n          image: docker.io/my-company/kubed:v0.13.2\n          volumeMounts:\n            - name: kubeconfig\n              mountPath: /srv/kubed\n            - name: aws-config\n              mountPath: /home/app/.aws\n            - name: kubed-master-aws\n              mountPath: /home/app/scripts\n          command:\n            - sh\n            - -c\n            - |\n              mkdir -p /home/app/.aws &&\n              cp /home/app/scripts/credentials /home/app/.aws &&\n              sh /home/app/scripts/generate-kubeconfig.sh &&\n              cp /home/app/.kube/config /srv/kubed/kubeconfig\n\n      containers:\n        - name: kubed-master\n          image: docker.io/my-company/kubed:v0.13.2\n          args:\n            - run\n            - --v=3\n            - --secure-port=8443\n            - --audit-log-path=-\n            - --tls-cert-file=/var/serving-cert/tls.crt\n            - --tls-private-key-file=/var/serving-cert/tls.key\n            - --use-kubeapiserver-fqdn-for-aks=true\n            - --enable-analytics=false\n            - --cluster-name=mc-mgmt\n            - --kubeconfig-file=/srv/kubed/kubeconfig\n            - --config-source-namespace=prod\n          ports:\n            - containerPort: 8443\n          resources: {}\n          volumeMounts:\n            - name: kubeconfig\n              mountPath: /srv/kubed\n            - name: aws-config\n              mountPath: /home/app/.aws\n            - name: scratch\n              mountPath: /tmp\n            - name: serving-cert\n              mountPath: /var/serving-cert\n      volumes:\n        # NOTE: we\'d like to generate kubeconfig during initContainer\n        - name: kubeconfig\n          emptyDir: {}\n          # secret:\n          #   secretName: kubed # NOTE: contains data.kubeconfig\n        - name: aws-config\n          emptyDir: {}\n        - name: kubed-master-aws\n          configMap:\n            name: kubed-master-aws\n            defaultMode: 0550\n        - name: scratch\n          emptyDir: {}\n        - name: serving-cert\n          secret:\n            defaultMode: 420\n            secretName: kubed-apiserver-cert\n      securityContext:\n        fsGroup: 1000\n')))),(0,o.kt)("h2",{id:"\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f-\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0439"},"\u0421\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0439"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: cross-acc-sync-demo\n  namespace: prod\n  annotations:\n    kubed.appscode.com/sync-contexts: "mc-project-k8s"\ndata:\n  foo: bar\n  spam: eggs\n')),(0,o.kt)("h2",{id:"\u043d\u044e\u0430\u043d\u0441\u044b-\u0440\u0430\u0431\u043e\u0442\u044b"},"\u041d\u044e\u0430\u043d\u0441\u044b \u0440\u0430\u0431\u043e\u0442\u044b"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f: \u044d\u0442\u043e ConfigMap, Secret"))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u0421\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 namespace-\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0432\u043e \u0444\u043b\u0430\u0433\u0430\u0445 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0432 namespace \u0441 \u0442\u0430\u043a\u0438\u043c \u0436\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435\u043c \u0432 follower \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430\u0445. \u041f\u0440\u0438 \u044d\u0442\u043e annotations \u0438 labels \u043d\u0430 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f\u0445 \u0432 follower \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430\u0445 \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f."),(0,o.kt)("li",{parentName:"ul"},"\u041f\u043e\u0432\u043e\u0434\u043e\u043c \u0434\u043b\u044f \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0439 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f: \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a pod-\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 ",(0,o.kt)("inlineCode",{parentName:"li"},".data")," \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438. \u0422.\u0435. \u0435\u0441\u043b\u0438 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0431\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043b\u0435\u043d\u0430 \u0432 follower \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435, \u043e\u043d\u0430 \u043d\u0435 \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0443\u0435\u0442\u0441\u044f \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u043e\u043c."),(0,o.kt)("li",{parentName:"ul"},"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0432 master \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0435, \u0443\u0434\u0430\u043b\u0438\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0432\u043e \u0432\u0441\u0435\u0445 follower-\u0430\u0445."),(0,o.kt)("li",{parentName:"ul"},"\u0412 \u0441\u043b\u0443\u0447\u0430\u0435, \u0435\u0441\u043b\u0438 \u0432 follower \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435 \u0435\u0441\u0442\u044c \u0441\u0432\u043e\u0439 kubed \u0434\u043b\u044f \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 namespace-\u0430\u043c\u0438, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c annotation-\u0438\u044e \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u0438 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0440\u0430\u0437\u0431\u0435\u0436\u0438\u0442\u0441\u044f \u043f\u043e namespace-\u0430\u043c. \u041f\u0440\u0438\u0447\u0435\u043c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 ",(0,o.kt)("inlineCode",{parentName:"li"},".data")," \u0432 master \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435 \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0441\u0435\u043a\u0440\u0435\u0442 \u0432 follower, \u043d\u043e \u043d\u0435 \u043f\u0435\u0440\u0435\u0442\u0440\u0435\u0442 \u044d\u0442\u0443 \u0430\u043d\u043d\u043e\u0442\u0430\u0446\u0438\u044e.")),(0,o.kt)("p",null,"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0430\u043d\u043d\u043e\u0442\u0430\u0446\u0438\u044e \u0432 follower \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl --context mc-project annotate cm cross-acc-sync-demo "kubed.appscode.com/sync=sync/kubed-master=true"\n')),(0,o.kt)("p",null,"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c label \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u0439 namespace \u0432 follower \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435, \u0447\u0442\u043e\u0431\u044b \u043c\u0435\u0441\u0442\u043d\u044b\u0439 kubed \u0437\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043b cm \u043c\u0435\u0436\u0434\u0443 namespace-\u0430\u043c\u0438."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n\nkind: Namespace\napiVersion: v1\nmetadata:\n  name: env-ahorbach\n  labels:\n    name: env-ahorbach\n    sync/kubed-master: "true"\n')),(0,o.kt)("h2",{id:"\u0441\u0441\u044b\u043b\u043a\u0438"},"\u0421\u0441\u044b\u043b\u043a\u0438"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://dev.to/hayderimran7/adding-cross-account-access-to-eks-5ebh"},"Imran Hayder: Adding cross-account access to EKS")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://aws.amazon.com/blogs/containers/enabling-cross-account-access-to-amazon-eks-cluster-resources/"},"AWS: Enabling cross-account access to Amazon EKS cluster resources")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://appscode.com/products/kubed/v0.12.0/guides/config-syncer/inter-cluster/"},"kubed: Synchronize Configuration across Clusters")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/kubeops/config-syncer/issues/457"},"jdepp: KS cross-cluster and cross-namespace syncing issue."))))}b.isMDXComponent=!0}}]);