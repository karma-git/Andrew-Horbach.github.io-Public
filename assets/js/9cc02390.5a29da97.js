"use strict";(self.webpackChunkclassic=self.webpackChunkclassic||[]).push([[366],{8936:function(n){n.exports=JSON.parse('{"blogPosts":[{"id":"selfmade-vagrant-box","metadata":{"permalink":"/Andrew-Horbach.github.io-Public/blog/selfmade-vagrant-box","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2022-01-28-self-vagrant-box.md","source":"@site/blog/2022-01-28-self-vagrant-box.md","title":"Selfmade Vagrant box","description":"VagrantBox \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0441\u044f \u043d\u0430\u0441\u0442\u043e\u043b\u044c\u043a\u043e \u0436\u0435 \u043f\u0440\u043e\u0441\u0442\u043e \u043a\u0430\u043a \u0438 DockerImage!","date":"2022-01-28T00:00:00.000Z","formattedDate":"January 28, 2022","tags":[{"label":"vagrant","permalink":"/Andrew-Horbach.github.io-Public/blog/tags/vagrant"},{"label":"packer","permalink":"/Andrew-Horbach.github.io-Public/blog/tags/packer"},{"label":"ansible","permalink":"/Andrew-Horbach.github.io-Public/blog/tags/ansible"}],"readingTime":1.75,"truncated":true,"authors":[{"name":"Andrew Horbach","url":"https://github.com/karma-git","imageURL":"https://github.com/karma-git.png","key":"a.horbach"}]},"content":"\x3c!-- import tabs --\x3e\\nimport Tabs from \'@theme/Tabs\';\\nimport TabItem from \'@theme/TabItem\';\\n\\n\u041d\u0430 VagrantCloud \u043d\u0435 \u043d\u0430\u0448\u0435\u043b \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u0445 box-\u043e\u0432 \u0441 GUI.\\n\\n## \u041f\u0440\u043e\u0446\u0435\u0441\u0441\\n\\n:::info\\n\u0411\u0443\u0434\u0443 \u0434\u0435\u043b\u0430\u0442\u044c \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0438 \u0441 _docker_\\n:::\\n\\n### config file\\n\\n\u041e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u043c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u043d\u0430\u0448\u0435\u0433\u043e VagrantBox (_DockerImage_) \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 `.hcl` (_terraform_)\\n\\n```hcl\\nsource \\"vagrant\\" \\"ubuntu\\" {\\n  add_force    = true\\n  communicator = \\"ssh\\"\\n  provider     = \\"virtualbox\\"\\n  source_path  = \\"ubuntu/focal64\\"\\n}\\n\\nbuild {\\n  name    = \\"learn-packer\\"\\n  sources = [\\n    \\"source.vagrant.ubuntu\\"\\n  ]\\n}\\n```\\n\\n:::tip\\n\u041f\u043e\u043b\u0435\u0437\u043d\u044b\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b:\\n```shell\\npacker validate packer.hcl  # \u0432\u0430\u043b\u0438\u0434\u0438\u0440\u0443\u0435\u0442 \u0444\u0430\u0439\u043b\\npacker fmt .                # \u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u0443\u0435\u0442 \u0444\u0430\u0439\u043b\u044b, \u0438 \u043a\u0430\u0436\u0435\u0442\u0441\u044f, \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044e\\n```\\n:::\\n\\n### build\\n\\n\u0421 \u043f\u043e\u043c\u043e\u0449\u044c\u044e [`packer`](https://www.packer.io/) (_docker engine_) \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u043c \u043e\u0431\u0440\u0430\u0437.\\n\\n```shell\\npacker build packer.hcl\\n```\\n\\n\u0427\u0435\u0440\u0435\u0437 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u0432 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 `learn-packer` \u043f\u043e\u044f\u0432\u0438\u0442\u0441\u044f \u0444\u0430\u0439\u043b `.box` (_docker_image_)\\n\\n### push\\n\\n\u0417\u0430\u043b\u0438\u0432\u0430\u0435\u043c \u043f\u043e\u043b\u0443\u0447\u0438\u0432\u0448\u0438\u0439\u0441\u044f \u0444\u0430\u0439\u043b \u043d\u0430 [VagrantCloud](https://app.vagrantup.com/boxes/search). \u041f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u044c\u0441\u044f \u0441\u043e\u0431\u0440\u0430\u0442\u044c \u0445\u044d\u0448-\u0441\u0443\u043c\u043c\u0443 \u0444\u0430\u0439\u043b\u0430, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0447\u0435\u0440\u0435\u0437 `md5`\\n\\n### provisioner\\n\\n:::note\\n\u041b\u044e\u0431\u0438\u043c\u044b\u0439 \u043f\u0440\u043e\u0432\u0438\u0436\u0435\u043d\u0435\u0440 - ansible, \u043d\u043e \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c `shell`\\n:::\\n\\n<Tabs defaultValue=\\"hcl\\">\\n<TabItem value=\\"hcl\\" label=\\"packer.hcl\\">\\n\\n```hcl\\nsource \\"vagrant\\" \\"ubuntu\\" {\\n  add_force    = true\\n  communicator = \\"ssh\\"\\n  provider     = \\"virtualbox\\"\\n  source_path  = \\"ubuntu/focal64\\"\\n}\\n\\nbuild {\\n  name    = \\"learn-packer\\"\\n  sources = [\\n    \\"source.vagrant.ubuntu\\"\\n  ]\\n  provisioner \\"ansible\\" {\\n    playbook_file = \\"./ansible/packer-playbook.yml\\"\\n  }\\n}\\n```\\n\\n</TabItem>\\n<TabItem value=\\"yml\\" label=\\"packer-playbook.yml\\">\\n\\n``` yml\\n---\\n\\n- name: install docker engine ubuntu\\n  hosts: all\\n\\n  become: true\\n  become_method: sudo\\n\\n  tasks:\\n    - name: 1. Update the apt package index and install packages to allow apt to use a repository over HTTPS\\n      apt:\\n        name: \\n          - apt-transport-https\\n          - ca-certificates\\n          - curl\\n          - gnupg\\n          - lsb-release\\n          - python3-pip\\n          - awscli\\n        state: latest\\n        update_cache: true\\n\\n    - name: 2. Add Docker\u2019s official GPG key\\n      apt_key:\\n        url: https://download.docker.com/linux/ubuntu/gpg\\n        state: present\\n\\n    - name: 3. Add Docker Repository\\n      apt_repository:\\n        repo: deb https://download.docker.com/linux/ubuntu focal stable  # FIXME move to var\\n        state: present\\n\\n    - name: 4. Install docker engine\\n      apt:\\n        name: docker-ce\\n        state: latest\\n        update_cache: true\\n\\n    # Docker post-install steps for ubuntu\\n\\n    - name: 1. Make sure that group \\"docker\\" exists\\n      group:\\n        name: docker\\n        state: present\\n\\n    - name: 2. Add aws user to docker docker group\\n      user:\\n        name: ubuntu\\n        groups: docker\\n        append: true\\n```\\n\\n</TabItem>\\n</Tabs>\\n\\n### post-processors\\n\\n:::caution\\n\u041d\u0435 \u043f\u0440\u043e\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043b\\n:::\\n\\n\u0428\u0442\u0443\u043a\u0438 \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043f\u043e\u0441\u043b\u0435 \u0441\u0431\u043e\u0440\u043a\u0438, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u0432 *VagrantCloud* (_docker push_)\\n\\n[GitHub repo](https://github.com/karma-git/playground/tree/master/environment/vagrant/ubuntu-gui)\\n\\n\x3c!--truncate--\x3e"}]}')}}]);